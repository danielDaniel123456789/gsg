<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQLite con JavaScript</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql.js"></script>
</head>
<body>

    <h1>Base de Datos SQLite en el Navegador</h1>
    <button onclick="cargarDatos()">Cargar Datos</button>
    <table id="tabla-datos" border="1">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Edad</th>
            </tr>
        </thead>
        <tbody>
            <!-- Aquí se cargarán los datos -->
        </tbody>
    </table>

    <script>
        // Espera a que el script de sql.js se haya cargado correctamente
        window.onload = function() {
            // Crear la base de datos SQLite en memoria
            const db = new window.SQL.Database();

            // Crear una tabla 'users' si no existe
            db.run("CREATE TABLE IF NOT EXISTS users (id INTEGER PRIMARY KEY, name TEXT, age INTEGER);");

            // Insertar algunos datos en la tabla
            function insertarDatos() {
                const stmt = db.prepare("INSERT INTO users (name, age) VALUES (?, ?)");
                stmt.run(["John Doe", 30]);
                stmt.run(["Jane Smith", 25]);
                stmt.run(["Michael Johnson", 35]);
                stmt.free();  // Liberar la declaración después de la inserción
            }

            // Función para cargar los datos de la base de datos en la tabla HTML
            function cargarDatos() {
                // Insertar los datos solo una vez (evitar inserción repetida)
                if (db.exec("SELECT COUNT(*) FROM users")[0].values[0][0] === 0) {
                    insertarDatos();  // Insertar datos si la tabla está vacía
                }

                // Consultar todos los usuarios
                const result = db.exec("SELECT * FROM users");

                // Obtener el cuerpo de la tabla
                const tbody = document.getElementById("tabla-datos").getElementsByTagName("tbody")[0];
                tbody.innerHTML = "";  // Limpiar la tabla antes de cargar los datos

                // Iterar sobre los resultados y agregar filas a la tabla
                result[0].values.forEach(row => {
                    const tr = document.createElement("tr");
                    tr.innerHTML = `
                        <td>${row[0]}</td>
                        <td>${row[1]}</td>
                        <td>${row[2]}</td>
                    `;
                    tbody.appendChild(tr);
                });
            }
        };
    </script>

</body>
</html>
